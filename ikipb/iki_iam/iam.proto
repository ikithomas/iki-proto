syntax = "proto3";

option go_package = "github.com/ikithomas/iki-proto/ikipb/iki_iam";

package iam;

// User is a human user
message User {
  reserved 5, 6, 7;

  string id = 1;
  string email = 2;
  string given_name = 3;
  string family_name = 4;
  repeated Group roles = 8;

  bool active = 9;
  int64 last_login_at = 10;
  int64 last_activity_at = 11;
}

message Group {
  string id = 1;
  string name = 2;
}

// Service is a microservice
message Service {
  // Internal ID of the service.
  string id = 1;

  // Client ID of the service. Used for authentication.
  string client_id = 2;

  // secret to authenticate to.
  repeated Secret secrets = 3;

  // Friendly name
  string name = 4;
}

message Secret {
  string id = 1;
  string secret = 2;
  int64 last_used_at = 3;
  bool active = 4;
}

enum EntityType {
  ENTITY_TYPE_UNSPECIFIED = 0;
  ENTITY_TYPE_USER = 1;
  ENTITY_TYPE_SERVICE = 2;
}

////////////////////////////////////////////////////////////////////////////////
// Events
//////

message EventUserLogin {
  string iki_user_id = 1;
  string email = 2;
}

message EventAccessToken {
  string entity_id = 1;
  EntityType entity_type = 2;
}
